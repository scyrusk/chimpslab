<%= form_for @publication, :html => { :class => 'form-horizontal' } do |f| %>
  <fieldset>
    <legend>Create New Publication</legend>

    <div class="control-group">
      <%= f.label :title, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :title, :class => 'text_field span5' %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :kind, "Type:", :class => 'control-label' %>
      <div class="controls">
        <%= f.select :kind, options_for_select(Publication::KINDS << "Other:", @publication.kind), :class => 'text_field span5' %>
        <%= f.text_field :kind, :class => "text_field span5", :style => "display:none;", :id => 'kind'  %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :authors, :class => 'control-label' %>
      <div class="controls">
        <p class="small">
          Each author on a separate line.
          For consistency, format should be
          firstname middle-initial. lastname, <i>e.g.</i>:
          <i>Jason I. Hong</i>
        </p>
        <%= f.text_area :authors, :class => 'text_area span5', :style => "height:100px;" %>
        <p class="small">
          Use the canonical names of members so that their names are automatically linked to their profiles.
        </p>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :venue_name, :class => 'control-label' %>
      <div class="controls">
        <% venue_names = Venue.where("publications_count > 0").map { |v| v.name } %>
        <%= f.select :venue_name, options_for_select(venue_names << "Other:", @publication.venue_name), :class => 'text_field span5' %>
        <%= f.text_field :venue_name, :class => "text_field span5", :style => "display:none;", :id => 'venue_name' %>
        <p class="small" style="margin-bottom:0">
          Use the name of the conference instead of the name of the proceedings,
          <i>e.g., CHI vs. Proceedings of The ACM Conference on Human Factors in Computing Systems.</i>
        </p>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :year, :class => 'control-label' %>
      <div class="controls">
        <%= f.number_field :year, :class => 'number_field span5' %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :abstract, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_area :abstract, :class => 'text_area span5' %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :pdf, :class => 'control-label' %>
      <div class="controls">
        <%= f.file_field :pdf, :class => 'file_field span5' %>
      </div>
    </div>

    <div class="form-actions">
      <%= f.submit nil, :class => 'btn btn-primary' %>
      <%= link_to 'Cancel', publications_path, :class => 'btn' %>
    </div>
  </fieldset>
<% end %>



<% content_for :js do %>
	<script type="text/javascript">
		function select_other(select_id, text_field_id) {
			// Prepare the event handler to the select.
			$(select_id).change(function() {
				var value = $(this).val();
				if (value == "Other:") {
					$(text_field_id)
						.show()
						.focus();
				} else {
					$(text_field_id)
						.val(value)
						.hide();
				}
			});
			
			// Check if the option exists.
			var option = $(text_field_id).val();
			var option_exists = false;
			$(select_id + " option").each(function() {
				if ($(this).html() == option) {
					option_exists = true;
					return false;
				}
			});
			
			// If not show, the text field.
			if (!option_exists) {
				$(select_id).val("Other:").change();
			}
		}
		
		$(document).ready(function() {
			select_other("#publication_kind", "#kind");
      select_other("#publication_venue_name", "#venue_name");
		});
	</script>
<% end %>

<% content_for :sb do %>
	<h2>Formatting your abstract</h2>
	
	<%= render :partial => "layouts/textile_examples" %>
<% end %>
